<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <meta name="generator" content="Hugo 0.146.6"><meta property="og:url" content="https://www.mikeperham.com/2012/12/07/12-gems-of-christmas-6-childprocess/">
  <meta property="og:site_name" content="Mike Perham">
  <meta property="og:title" content="12 Gems of Christmas #6 -- childprocess">
  <meta property="og:description" content="Ruby has many different gems and APIs for spawning child processes but none I like more than childprocess. posix-spawn and open4 are popular alternatives but childprocess has a clean Ruby API and aims to work on all Ruby platforms.
Here we have an example setting up a child process pipeline, performing the equivalent of ps aux | grep -E &#39;redis|memcached&#39;.
require &#39;childprocess&#39; listing = ChildProcess.build(&#34;ps&#34;, &#34;aux&#34;) search = ChildProcess.build(&#34;grep&#34;, &#39;-E&#39;, %w(redis memcached).join(&#39;|&#39;)) search.duplex = true search.io.stdout = STDOUT search.start listing.io.stdout = search.io.stdin listing.start listing.wait search.io.stdin.close search.wait With subprocesses, the tricky bit is usually hooking up the IO streams correctly. In this case, the duplex flag signals that you want to write to STDIN of the process (i.e. use it as the RHS of a pipe). Everything else is pretty straightforward; childprocess makes multi-processing with Ruby simple.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2012-12-07T00:00:00+00:00">
    <meta property="article:modified_time" content="2012-12-07T00:00:00+00:00">

  <meta name="description" content="Ruby, OSS and the Internet">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://www.mikeperham.com/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://www.mikeperham.com/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://www.mikeperham.com/favicon-16x16.png">

  
  <link rel="manifest" href="https://www.mikeperham.com/site.webmanifest">

  
  <link rel="mask-icon" href="https://www.mikeperham.com/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="/css/bootstrap.min.css" integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous">
  <link rel="alternate" type="application/rss+xml" href="https://mikeperham.com/index.xml" title="Mike Perham">

  
  <title>12 Gems of Christmas #6 -- childprocess | Mike Perham</title>
  

  <style>
body {
  min-width: 300px;
  font-size: 19px;
}

.publish-date {
  font-family: monospace;
  font-size: 0.8em;
  margin-right: 0.5em;
}

.custom-navbar {
  margin-bottom: 1em;
}

@media print {
  .custom-navbar {
    display: none;
  }
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 960px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>

</head>


<body>
  <nav class="custom-navbar navbar navbar-expand-md navbar-dark bg-dark">
  <div class="container">
    <a class="navbar-brand mr-0" href="/">Mike Perham</a>
    <ul class="navbar-nav d-flex flex-row">
      <li class="nav-item"><a class="nav-link" title="Sidekiq" href="https://sidekiq.org">Sidekiqü•ã</a></li>
      <li class="nav-item"><a class="nav-link" title="Faktory" href="https://contribsys.com/faktory">Faktoryüè≠</a></li>
    </ul>
    <ul class="navbar-nav float-right d-none d-md-flex">
      
      <li class="nav-item"><a class="nav-link" href="mailto:mike@perham.net">üìß Email</a></li>
      <li class="nav-item"><a class="nav-link" rel="me" href="https://ruby.social/@getajobmike">üì£ Mastodon</a></li>
      <li class="nav-item"><a class="nav-link" href="/index.xml" title="RSS"><img src="/images/rss.png" width="16"
            height="16" /> RSS</a></li>
      <li class="nav-item d-none d-md-flex"><a class="nav-link" title="About" href="/about/">‚ùì</a></li>
    </ul>
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>12 Gems of Christmas #6 &ndash; childprocess</h1>
<p>
  <small class="text-secondary">
  
  
  2012-12-07
  </small>
  
</p>
<p>Ruby has many different gems and APIs for spawning child processes but none I like more than childprocess. <a href="https://github.com/rtomayko/posix-spawn">posix-spawn</a> and <a href="https://github.com/ahoward/open4">open4</a> are popular alternatives but <a href="https://github.com/jarib/childprocess">childprocess</a> has a clean Ruby API and aims to work on all Ruby platforms.</p>
<p>Here we have an example setting up a child process pipeline, performing the equivalent of <code>ps aux | grep -E 'redis|memcached'</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>require <span style="color:#e6db74">&#39;childprocess&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>listing <span style="color:#f92672">=</span> <span style="color:#66d9ef">ChildProcess</span><span style="color:#f92672">.</span>build(<span style="color:#e6db74">&#34;ps&#34;</span>, <span style="color:#e6db74">&#34;aux&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>search <span style="color:#f92672">=</span> <span style="color:#66d9ef">ChildProcess</span><span style="color:#f92672">.</span>build(<span style="color:#e6db74">&#34;grep&#34;</span>, <span style="color:#e6db74">&#39;-E&#39;</span>, <span style="color:#e6db74">%w(redis memcached)</span><span style="color:#f92672">.</span>join(<span style="color:#e6db74">&#39;|&#39;</span>))
</span></span><span style="display:flex;"><span>search<span style="color:#f92672">.</span>duplex <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>search<span style="color:#f92672">.</span>io<span style="color:#f92672">.</span>stdout <span style="color:#f92672">=</span> <span style="color:#66d9ef">STDOUT</span>
</span></span><span style="display:flex;"><span>search<span style="color:#f92672">.</span>start
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>listing<span style="color:#f92672">.</span>io<span style="color:#f92672">.</span>stdout <span style="color:#f92672">=</span> search<span style="color:#f92672">.</span>io<span style="color:#f92672">.</span>stdin
</span></span><span style="display:flex;"><span>listing<span style="color:#f92672">.</span>start
</span></span><span style="display:flex;"><span>listing<span style="color:#f92672">.</span>wait
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>search<span style="color:#f92672">.</span>io<span style="color:#f92672">.</span>stdin<span style="color:#f92672">.</span>close
</span></span><span style="display:flex;"><span>search<span style="color:#f92672">.</span>wait
</span></span></code></pre></div><p>With subprocesses, the tricky bit is usually hooking up the IO streams correctly. In this case, the <code>duplex</code> flag signals that you want to write to STDIN of the process (i.e. use it as the RHS of a pipe). Everything else is pretty straightforward; childprocess makes multi-processing with Ruby simple.</p>
<p>Tomorrow I&rsquo;ll dive into a little gem which aims to improve Rails logging in production.</p>

    </article>
  </div>

  

</body>

</html>
