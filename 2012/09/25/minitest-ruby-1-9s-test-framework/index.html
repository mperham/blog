<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <meta name="generator" content="Hugo 0.146.6"><meta property="og:url" content="https://www.mikeperham.com/2012/09/25/minitest-ruby-1-9s-test-framework/">
  <meta property="og:site_name" content="Mike Perham">
  <meta property="og:title" content="MiniTest -- Ruby 1.9&#39;s test framework">
  <meta property="og:description" content="(this is a classic post I wrote two years ago for another site which is shutting down, saving here since it‚Äôs still very useful)
Aaron Patterson gave a talk at GoGaRuCo 2010 about the latest changes in Ruby 1.9.2‚Äôs standard library and one of the topics he spoke on was MiniTest. The Ruby community has been particularly innovative in the world of testing and Ruby 1.8‚Äôs Test::Unit library is circa 2003, providing nothing but the most basic testing API. Every Ruby project I‚Äôve ever worked on has skipped Test::Unit and pulled in many different test gems (e.g. rspec, shoulda, mocha, flexmock) to provide a modern test infrastructure.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2012-09-25T00:00:00+00:00">
    <meta property="article:modified_time" content="2012-09-25T00:00:00+00:00">

  <meta name="description" content="Ruby, OSS and the Internet">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://www.mikeperham.com/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://www.mikeperham.com/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://www.mikeperham.com/favicon-16x16.png">

  
  <link rel="manifest" href="https://www.mikeperham.com/site.webmanifest">

  
  <link rel="mask-icon" href="https://www.mikeperham.com/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="/css/bootstrap.min.css" integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous">
  <link rel="alternate" type="application/rss+xml" href="https://mikeperham.com/index.xml" title="Mike Perham">

  
  <title>MiniTest -- Ruby 1.9&#39;s test framework | Mike Perham</title>
  

  <style>
body {
  min-width: 300px;
  font-size: 19px;
}

.publish-date {
  font-family: monospace;
  font-size: 0.8em;
  margin-right: 0.5em;
}

.custom-navbar {
  margin-bottom: 1em;
}

@media print {
  .custom-navbar {
    display: none;
  }
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 960px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>

</head>


<body>
  <nav class="custom-navbar navbar navbar-expand-md navbar-dark bg-dark">
  <div class="container">
    <a class="navbar-brand mr-0" href="/">Mike Perham</a>
    <ul class="navbar-nav d-flex flex-row">
      <li class="nav-item"><a class="nav-link" title="Sidekiq" href="https://sidekiq.org">Sidekiqü•ã</a></li>
      <li class="nav-item"><a class="nav-link" title="Faktory" href="https://contribsys.com/faktory">Faktoryüè≠</a></li>
    </ul>
    <ul class="navbar-nav float-right d-none d-md-flex">
      
      <li class="nav-item"><a class="nav-link" href="mailto:mike@perham.net">üìß Email</a></li>
      <li class="nav-item"><a class="nav-link" rel="me" href="https://ruby.social/@getajobmike">üì£ Mastodon</a></li>
      <li class="nav-item"><a class="nav-link" href="/index.xml" title="RSS"><img src="/images/rss.png" width="16"
            height="16" /> RSS</a></li>
      <li class="nav-item d-none d-md-flex"><a class="nav-link" title="About" href="/about/">‚ùì</a></li>
    </ul>
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>MiniTest &ndash; Ruby 1.9&rsquo;s test framework</h1>
<p>
  <small class="text-secondary">
  
  
  2012-09-25
  </small>
  
</p>
<p>(this is a classic post I wrote two years ago for another site which is shutting down, saving here since it&rsquo;s still very useful)</p>
<p>Aaron Patterson gave a talk at GoGaRuCo 2010 about the latest changes in Ruby 1.9.2&rsquo;s standard library and one of the topics he spoke on was MiniTest. The Ruby community has been particularly innovative in the world of testing and Ruby 1.8&rsquo;s Test::Unit library is circa 2003, providing nothing but the most basic testing API. Every Ruby project I&rsquo;ve ever worked on has skipped Test::Unit and pulled in many different test gems (e.g. rspec, shoulda, mocha, flexmock) to provide a modern test infrastructure.</p>
<h2 id="testunit-refresher">Test::Unit Refresher</h2>
<p>With Test::Unit, you just subclass Test::Unit::TestCase, name your methods starting with &rsquo;test&rsquo; and include one or more assertions to verify:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TestSomething</span> <span style="color:#f92672">&amp;</span>lt; <span style="color:#66d9ef">Test</span><span style="color:#f92672">::</span><span style="color:#66d9ef">Unit</span><span style="color:#f92672">::</span><span style="color:#66d9ef">TestCase</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_foo</span>
</span></span><span style="display:flex;"><span>    foo <span style="color:#f92672">=</span> <span style="color:#66d9ef">Foo</span><span style="color:#f92672">.</span>new
</span></span><span style="display:flex;"><span>    assert foo
</span></span><span style="display:flex;"><span>    bar <span style="color:#f92672">=</span> <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>    assert_nil bar
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span></code></pre></div><p>Believe it or not, Test::Unit is actually rather slow and bloated. It includes a number of GUIs (GTk v1, GTk v2, FxRuby) that are rarely if ever used. A revamp was needed&hellip;</p>
<h2 id="enter-minitest">Enter MiniTest</h2>
<p>Ruby 1.9 includes an updated version of the venerable Test::Unit which removes a lot of the more esoteric features, called <a href="http://bfts.rubyforge.org/minitest/">MiniTest</a>. You don&rsquo;t need to do anything to use MiniTest in 1.9, it replaces Test::Unit and provides a backwards compatible API that provides the 90% of Test::Unit that people were using often. You can even use minitest on Ruby 1.8 by installing the `minitest` gem. Aside from the Test::Unit API, several improvements over Test::Unit are included:</p>
<p><strong>Randomization</strong></p>
<p>When you run your test suite, you might notice this at the bottom:</p>
<pre tabindex="0"><code>Test run options: --seed 1261
</code></pre><p>This is because MiniTest by default runs your tests in random order. This is a good thing because it prevents your tests from accidentally becoming order-dependent due to &ldquo;state leakage&rdquo;. If you find that your tests are breaking randomly, it is most likely due to this state leakage. You can run your tests with the same seed to reproduce the problem:</p>
<pre tabindex="0"><code>rake TESTOPTS=&#34;--seed=1261&#34;
</code></pre><p><strong>Skip Tests</strong></p>
<p>MiniTest allows you to easily skip tests that are not working with the `skip` method:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test_foo</span>
</span></span><span style="display:flex;"><span>  skip(<span style="color:#e6db74">&#34;Need to debug this...&#34;</span>)
</span></span><span style="display:flex;"><span>  assert_equal <span style="color:#66d9ef">false</span>, <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span></code></pre></div><p>which results in this:</p>
<pre tabindex="0"><code>83 tests, 106 assertions, 0 failures, 0 errors, 1 skips
</code></pre><p><strong>Verbosity</strong></p>
<p>MiniTest also has a &lsquo;-v&rsquo; flag which will print out the time each test takes - excellent for determining those tests which are slowing down your test suite:</p>
<pre tabindex="0"><code>rake TESTOPTS=&#34;-v&#34;
</code></pre><p>which emits a line for each test. It&rsquo;s too bad it doesn&rsquo;t have an option for sorting or a minimum time (like 0.1 sec); this would be useful for suites which have thousands of tests.</p>
<pre tabindex="0"><code>TestMemCache#test_check_size_off: 0.02 s: .
TestMemCache#test_check_size_on: 0.01 s: .
TestMemCache#test_consistent_hashing: 0.11 s: .
TestMemCache#test_crazy_multithreaded_access: 0.00 s: S
TestMemCache#test_custom_encoding: 0.00 s: .
TestMemCache#test_decr: 0.00 s: .
</code></pre><p><strong>BDD DSL</strong></p>
<p>MiniTest also includes a basic BDD DSL like RSpec:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>require <span style="color:#e6db74">&#39;minitest/spec&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>describe <span style="color:#66d9ef">Meme</span> <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>  before <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>    @meme <span style="color:#f92672">=</span> <span style="color:#66d9ef">Meme</span><span style="color:#f92672">.</span>new
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  describe <span style="color:#e6db74">&#34;when asked about cheeseburgers&#34;</span> <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>    it <span style="color:#e6db74">&#34;should respond positively&#34;</span> <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>      @meme<span style="color:#f92672">.</span>i_can_has_cheezburger?<span style="color:#f92672">.</span>must_equal <span style="color:#e6db74">&#34;OHAI!&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  describe <span style="color:#e6db74">&#34;when asked about blending possibilities&#34;</span> <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>    it <span style="color:#e6db74">&#34;won&#39;t say no&#34;</span> <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>      @meme<span style="color:#f92672">.</span>does_it_blend?<span style="color:#f92672">.</span>wont_match <span style="color:#e6db74">/^no/i</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span></code></pre></div><p>It even includes a basic mocking API which you can read about in the <a href="http://bfts.rubyforge.org/minitest/">MiniTest documentation</a>. These changes are a great step forward for Ruby&rsquo;s standard test library. Personally I&rsquo;m going to use MiniTest on my next project and see if I can slim down my test dependencies. Happy coding!</p>

    </article>
  </div>

  

</body>

</html>
