<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <meta name="generator" content="Hugo 0.146.4"><meta property="og:url" content="https://www.mikeperham.com/2007/12/09/using-berkeley-db-with-ruby/">
  <meta property="og:site_name" content="Mike Perham">
  <meta property="og:title" content="Using Berkeley DB with Ruby">
  <meta property="og:description" content="I‚Äôve been going very deep into BDB recently.¬†There‚Äôs a couple things I‚Äôve learned:
The Ruby binding effectively only allows you to store strings, not native types.¬†So that 4 byte integer will instead take anywhere from 1-10 bytes, depending on the value. The Ruby binding does support sorting via a Ruby proc but it‚Äôs extremely slow.¬†Where possible, try to structure your data such that the default lexical sorting can be used.¬†Fortunately the limitation in (1) works in your favor here since integers don‚Äôt sort correctly when using lexical sorting on LSB architectures like the i386. Being able to tune the data structures and transaction semantics based on your particular needs can lead to some enormous performance benefits.¬†Enabling the DB_TXN_NOSYNC flag means you lose the D property in ACID but you get an order of magnitude performance boost from it.¬†In our case it‚Äôs not vital and therefore immediately boosts BDB well past RDBMSes in write performance. I did find one or two bugs in the Ruby binding which should be fixed in the next release.¬†Guy¬†has provided quick and knowledgable support for the binding, so despite the lack of community resources for it, I‚Äôm confident we can make it work for us.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2007-12-09T00:00:00+00:00">
    <meta property="article:modified_time" content="2007-12-09T00:00:00+00:00">

  <meta name="description" content="Ruby, OSS and the Internet">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://www.mikeperham.com/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://www.mikeperham.com/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://www.mikeperham.com/favicon-16x16.png">

  
  <link rel="manifest" href="https://www.mikeperham.com/site.webmanifest">

  
  <link rel="mask-icon" href="https://www.mikeperham.com/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="/css/bootstrap.min.css" integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous">
  <link rel="alternate" type="application/rss+xml" href="https://mikeperham.com/index.xml" title="Mike Perham">

  
  <title>Using Berkeley DB with Ruby | Mike Perham</title>
  

  <style>
body {
  min-width: 300px;
  font-size: 19px;
}

.publish-date {
  font-family: monospace;
  font-size: 0.8em;
  margin-right: 0.5em;
}

.custom-navbar {
  margin-bottom: 1em;
}

@media print {
  .custom-navbar {
    display: none;
  }
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 960px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>

</head>


<body>
  <nav class="custom-navbar navbar navbar-expand-md navbar-dark bg-dark">
  <div class="container">
    <a class="navbar-brand mr-0" href="/">Mike Perham</a>
    <ul class="navbar-nav d-flex flex-row">
      <li class="nav-item"><a class="nav-link" title="Sidekiq" href="https://sidekiq.org">Sidekiqü•ã</a></li>
      <li class="nav-item"><a class="nav-link" title="Faktory" href="https://contribsys.com/faktory">Faktoryüè≠</a></li>
    </ul>
    <ul class="navbar-nav float-right d-none d-md-flex">
      
      <li class="nav-item"><a class="nav-link" href="mailto:mike@perham.net">üìß Email</a></li>
      <li class="nav-item"><a class="nav-link" rel="me" href="https://ruby.social/@getajobmike">üì£ Mastodon</a></li>
      <li class="nav-item"><a class="nav-link" href="/index.xml" title="RSS"><img src="/images/rss.png" width="16"
            height="16" /> RSS</a></li>
      <li class="nav-item d-none d-md-flex"><a class="nav-link" title="About" href="/about/">‚ùì</a></li>
    </ul>
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>Using Berkeley DB with Ruby</h1>
<p>
  <small class="text-secondary">
  
  
  2007-12-09
  </small>
  
</p>
<p>I&rsquo;ve been going very deep into BDB recently.¬† There&rsquo;s a couple things I&rsquo;ve learned:</p>
<ol>
<li>The Ruby binding effectively only allows you to store strings, not native types.¬† So that 4 byte integer will instead take anywhere from 1-10 bytes, depending on the value.</li>
<li>The Ruby binding does support sorting via a Ruby proc but it&rsquo;s extremely slow.¬† Where possible, try to structure your data such that the default lexical sorting can be used.¬† Fortunately the limitation in (1) works in your favor here since integers don&rsquo;t sort correctly when using lexical sorting on LSB architectures like the i386.</li>
<li>Being able to tune the data structures and transaction semantics based on your particular needs can lead to some enormous performance benefits.¬† Enabling the DB_TXN_NOSYNC flag means you lose the D property in ACID but you get an order of magnitude performance boost from it.¬† In our case it&rsquo;s not vital and therefore immediately boosts BDB well past RDBMSes in write performance.</li>
</ol>
<p>I did find one or two bugs in the Ruby binding which should be fixed in the next release.¬† Guy¬† has provided quick and knowledgable support for the binding, so despite the lack of community resources for it, I&rsquo;m confident we can make it work for us.</p>
<p>Any other tips or tricks from others?</p>

    </article>
  </div>

  

</body>

</html>
